/**
 * Container Block - Editor Styles
 *
 * @package Magical_Blocks
 * @since   1.0.0
 */

// Elementor-style grid outline color
$mgb-grid-outline-color: #d5dadf;
$mgb-grid-outline-hover-color: #a4afb7;
$mgb-grid-outline-selected-color: var(--wp-admin-theme-color, #007cba);

// Editor-specific styles
.wp-block-magical-blocks-container {
	// Use CSS variable for min-height with editor fallback
	min-height: var(--mgb-container-min-height, 50px);
	
	// Ensure background image displays properly in editor
	&.mgb-container {
		background-image: var(--mgb-container-bg-image);
		
		&.mgb-container--has-gradient {
			background-image: var(--mgb-container-bg-gradient), var(--mgb-container-bg-image);
		}
		
		&:not(.mgb-container--has-bg-image).mgb-container--has-gradient {
			background-image: var(--mgb-container-bg-gradient);
		}
	}
	
	// Elementor-style always visible grid outline
	outline: 1px dashed $mgb-grid-outline-color;
	outline-offset: -1px;
	transition: outline-color 0.2s ease;
	
	// Hover state - darker outline
	&:hover {
		outline-color: $mgb-grid-outline-hover-color;
	}
	
	// Selected state - theme color solid outline
	&.is-selected,
	&.has-child-selected {
		outline: 2px solid $mgb-grid-outline-selected-color;
		outline-offset: -2px;
	}

	// When empty and no background, show placeholder area
	&:not([style*="--mgb-container-bg-image"]):not([style*="--mgb-container-bg-color"]):not([style*="--mgb-container-bg-gradient"]) {
		&:empty,
		& > .mgb-container__inner:empty {
			min-height: 100px;
			background: repeating-linear-gradient(
				-45deg,
				transparent,
				transparent 5px,
				rgba(0, 0, 0, 0.03) 5px,
				rgba(0, 0, 0, 0.03) 10px
			);
		}
	}
}

// Layout Presets Grid
.mgb-layout-presets {
	display: grid;
	grid-template-columns: repeat(3, 1fr);
	gap: 8px;
	
	.mgb-layout-preset-btn {
		display: flex;
		align-items: center;
		justify-content: center;
		height: 48px;
		padding: 8px;
		border: 1px solid #ddd;
		border-radius: 4px;
		background: #fff;
		cursor: pointer;
		transition: all 0.2s ease;
		
		&:hover {
			border-color: var(--wp-admin-theme-color, #007cba);
			background: #f0f7fc;
		}
		
		&:focus {
			box-shadow: 0 0 0 2px var(--wp-admin-theme-color, #007cba);
			outline: none;
		}
		
		svg {
			color: #1e1e1e;
		}
	}
}

// Editor appender button styling
.mgb-container__inner {
	.block-list-appender {
		margin: 0;
		
		.block-editor-inserter {
			margin: 8px;
		}
	}
}

// Tab panel styling
.mgb-tab-panel {
	.components-tab-panel__tabs {
		margin-bottom: 16px;
		border-bottom: 1px solid #ddd;
	}

	.components-tab-panel__tabs-item {
		padding: 8px 16px;
		font-size: 13px;
		
		&.is-active {
			border-bottom: 2px solid var(--wp-admin-theme-color, #007cba);
			color: var(--wp-admin-theme-color, #007cba);
		}
	}

	.components-tab-panel__tab-content {
		padding-top: 8px;
	}
}

// Spacing section styling
.mgb-spacing-section {
	margin-bottom: 24px;
	padding-bottom: 16px;
	border-bottom: 1px solid #e0e0e0;

	&:last-child {
		border-bottom: none;
		margin-bottom: 0;
		padding-bottom: 0;
	}
}

.mgb-spacing-label {
	font-weight: 500;
	font-size: 11px;
	text-transform: uppercase;
	color: #1e1e1e;
}

// Media upload styling
.mgb-media-upload {
	margin-top: 8px;
}

.mgb-media-preview {
	position: relative;
	
	img {
		display: block;
		width: 100%;
		height: auto;
		border-radius: 4px;
	}
}

.mgb-media-actions {
	display: flex;
	gap: 8px;
	margin-top: 8px;
}

// Inspector controls improvements
.components-panel__body {
	.components-base-control {
		margin-bottom: 16px;
		
		&:last-child {
			margin-bottom: 0;
		}
	}
}

// Responsive control in container
.mgb-container-responsive-control {
	.components-flex {
		flex-wrap: wrap;
	}
	
	.components-flex-item {
		min-width: 80px;
		flex: 1;
	}
}

// Editor support for Inner Container flex behavior
// In the editor, WordPress wraps InnerBlocks with additional divs:
// .mgb-container__inner > .block-editor-inner-blocks > .block-editor-block-list__layout > .wp-block
.editor-styles-wrapper {
	.mgb-container__inner {
		// The inner-blocks wrapper needs to inherit flex
		> .block-editor-inner-blocks {
			display: flex;
			flex-direction: inherit;
			justify-content: inherit;
			align-items: inherit;
			flex-wrap: inherit;
			column-gap: inherit;
			row-gap: inherit;
			width: 100%;
			
			// The block list layout also needs flex
			> .block-editor-block-list__layout {
				display: flex;
				flex-direction: inherit;
				justify-content: inherit;
				align-items: inherit;
				flex-wrap: inherit;
				column-gap: inherit;
				row-gap: inherit;
				width: 100%;
				
				// Target the actual Inner Container blocks
				> .wp-block-magical-blocks-inner-container,
				> [data-type="magical-blocks/inner-container"] {
					// Flex child properties for auto width distribution
					flex: var(--mgb-inner-flex-grow, 1) var(--mgb-inner-flex-shrink, 1) var(--mgb-inner-width, 0%);
					min-width: 0;
					max-width: 100%;
				}
			}
		}
	}
}

// Override frontend tablet styles (991px) in editor context
// This range (712px-991px) should show DESKTOP styles in the editor
// because the sidebar takes ~280px, making the content area appear narrower
@media (min-width: 488px) and (max-width: 991px) {
	.mgb-container {
		// Force desktop values to override frontend's 991px tablet styles
		max-width: var(--mgb-container-width) !important;
		min-height: var(--mgb-container-min-height) !important;
		
		flex-direction: var(--mgb-container-direction) !important;
		justify-content: var(--mgb-container-justify) !important;
		align-items: var(--mgb-container-align) !important;
		flex-wrap: var(--mgb-container-wrap) !important;
		column-gap: var(--mgb-container-column-gap) !important;
		row-gap: var(--mgb-container-row-gap) !important;
		
		padding-top: var(--mgb-container-padding-top) !important;
		padding-right: var(--mgb-container-padding-right) !important;
		padding-bottom: var(--mgb-container-padding-bottom) !important;
		padding-left: var(--mgb-container-padding-left) !important;
		margin-top: var(--mgb-container-margin-top) !important;
		margin-right: var(--mgb-container-margin-right) !important;
		margin-bottom: var(--mgb-container-margin-bottom) !important;
		margin-left: var(--mgb-container-margin-left) !important;
		
		border-radius: var(--mgb-container-border-radius) !important;
	}
	
	.mgb-container--boxed {
		max-width: var(--mgb-container-width, 1200px) !important;
	}
}

// Responsive - Tablet
// Note: Editor breakpoints are reduced by ~280px to account for sidebar width
// Frontend uses standard 991px breakpoint (see style.scss)
@media (max-width: 711px) {
	.mgb-container {
		// Layout
		max-width: var(--mgb-container-width-tablet, var(--mgb-container-width));
		min-height: var(--mgb-container-min-height-tablet, var(--mgb-container-min-height));
		
		// Flexbox
		flex-direction: var(--mgb-container-direction-tablet, var(--mgb-container-direction));
		justify-content: var(--mgb-container-justify-tablet, var(--mgb-container-justify));
		align-items: var(--mgb-container-align-tablet, var(--mgb-container-align));
		flex-wrap: var(--mgb-container-wrap-tablet, var(--mgb-container-wrap));
		column-gap: var(--mgb-container-column-gap-tablet, var(--mgb-container-column-gap));
		row-gap: var(--mgb-container-row-gap-tablet, var(--mgb-container-row-gap));
		
		// Spacing
		padding-top: var(--mgb-container-padding-top-tablet, var(--mgb-container-padding-top));
		padding-right: var(--mgb-container-padding-right-tablet, var(--mgb-container-padding-right));
		padding-bottom: var(--mgb-container-padding-bottom-tablet, var(--mgb-container-padding-bottom));
		padding-left: var(--mgb-container-padding-left-tablet, var(--mgb-container-padding-left));
		margin-top: var(--mgb-container-margin-top-tablet, var(--mgb-container-margin-top));
		margin-right: var(--mgb-container-margin-right-tablet, var(--mgb-container-margin-right));
		margin-bottom: var(--mgb-container-margin-bottom-tablet, var(--mgb-container-margin-bottom));
		margin-left: var(--mgb-container-margin-left-tablet, var(--mgb-container-margin-left));
		
		// Border
		border-radius: var(--mgb-container-border-radius-tablet, var(--mgb-container-border-radius));
	}

	.mgb-container--boxed {
		max-width: var(--mgb-container-width-tablet, var(--mgb-container-width, 1200px));
	}
}

// Responsive - Mobile
// Note: Editor breakpoints are reduced by ~280px to account for sidebar width
// Frontend uses standard 767px breakpoint (see style.scss)
@media (max-width: 487px) {
	.mgb-container {
		// Layout
		max-width: var(--mgb-container-width-mobile, var(--mgb-container-width-tablet, var(--mgb-container-width)));
		min-height: var(--mgb-container-min-height-mobile, var(--mgb-container-min-height-tablet, var(--mgb-container-min-height)));
		
		// Flexbox
		flex-direction: var(--mgb-container-direction-mobile, var(--mgb-container-direction-tablet, var(--mgb-container-direction)));
		justify-content: var(--mgb-container-justify-mobile, var(--mgb-container-justify-tablet, var(--mgb-container-justify)));
		align-items: var(--mgb-container-align-mobile, var(--mgb-container-align-tablet, var(--mgb-container-align)));
		flex-wrap: var(--mgb-container-wrap-mobile, var(--mgb-container-wrap-tablet, var(--mgb-container-wrap)));
		column-gap: var(--mgb-container-column-gap-mobile, var(--mgb-container-column-gap-tablet, var(--mgb-container-column-gap)));
		row-gap: var(--mgb-container-row-gap-mobile, var(--mgb-container-row-gap-tablet, var(--mgb-container-row-gap)));
		
		// Spacing
		padding-top: var(--mgb-container-padding-top-mobile, var(--mgb-container-padding-top-tablet, var(--mgb-container-padding-top)));
		padding-right: var(--mgb-container-padding-right-mobile, var(--mgb-container-padding-right-tablet, var(--mgb-container-padding-right)));
		padding-bottom: var(--mgb-container-padding-bottom-mobile, var(--mgb-container-padding-bottom-tablet, var(--mgb-container-padding-bottom)));
		padding-left: var(--mgb-container-padding-left-mobile, var(--mgb-container-padding-left-tablet, var(--mgb-container-padding-left)));
		margin-top: var(--mgb-container-margin-top-mobile, var(--mgb-container-margin-top-tablet, var(--mgb-container-margin-top)));
		margin-right: var(--mgb-container-margin-right-mobile, var(--mgb-container-margin-right-tablet, var(--mgb-container-margin-right)));
		margin-bottom: var(--mgb-container-margin-bottom-mobile, var(--mgb-container-margin-bottom-tablet, var(--mgb-container-margin-bottom)));
		margin-left: var(--mgb-container-margin-left-mobile, var(--mgb-container-margin-left-tablet, var(--mgb-container-margin-left)));
		
		// Border
		border-radius: var(--mgb-container-border-radius-mobile, var(--mgb-container-border-radius-tablet, var(--mgb-container-border-radius)));
	}

	.mgb-container--boxed {
		max-width: var(--mgb-container-width-mobile, var(--mgb-container-width-tablet, var(--mgb-container-width, 100%)));
	}
}
